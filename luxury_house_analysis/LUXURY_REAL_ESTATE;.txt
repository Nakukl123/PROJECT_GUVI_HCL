CREATE DATABASE LUXURY_REAL_ESTATE;
CREATE SCHEMA HOUSING; 

DROP TABLE REAL_ESTATE_CLEAN;

CREATE OR REPLACE TABLE REAL_ESTATE_CLEAN(
    PROPERTY_ID STRING,
    MICRO_MARKET STRING,
    PROJECT_NAME STRING,
    DEVELOPER_NAME STRING,
    UNIT_SIZE_SQFT FLOAT,
    CONFIGURATION STRING,
    TICKET_PRICE_CR FLOAT,
    TRANSACTION_TYPE STRING,
    BUYER_TYPE STRING,
    PURCHASE_QUARTER DATE,
    CONNECTIVITY_SCORE FLOAT,
    AMENITY_SCORE FLOAT,
    POSSESSION_STATUS STRING,
    SALES_CHANNEL STRING,
    NRI_BUYER STRING,
    LOCALITY_INFRA_SCORE FLOAT,
    AVG_TRAFFIC_TIME_MIN FLOAT,
    BUYER_COMMENTS STRING,
    PRICE_PER_SQFT FLOAT,
    QUARTER_NUMBER INT,
    BOOKING_FLAG INT,
    HAS_BUYER_COMMENT INT
);

SELECT * FROM REAL_ESTATE_CLEAN;

--4,15,17

SELECT
    MICRO_MARKET,
    COUNT(PROPERTY_ID) AS TOTAL_PROPERTIES,
    SUM(TICKET_PRICE_CR) AS TOTAL_SALES
FROM 
    REAL_ESTATE_CLEAN
GROUP BY 1
ORDER BY 3 DESC;

SELECT 
    MICRO_MARKET,
    ROUND((SUM(PRICE_PER_SQFT)/10000000),2) AS TOTAL_PRICE_PER_SQFT
FROM 
    REAL_ESTATE_CLEAN
GROUP BY 1
ORDER BY 2 DESC;

SELECT * FROM REAL_ESTATE_CLEAN;

SELECT 
    QUARTER_NUMBER,
    EXTRACT(YEAR FROM PURCHASE_QUARTER) AS YEARS,
    COUNT(PROPERTY_ID) AS TOTAL_PROPERTIES,
    SUM(TICKET_PRICE_CR) AS TOTAL_SALES
FROM 
    REAL_ESTATE_CLEAN
GROUP BY 1,2
ORDER BY 2, 3 DESC;

SELECT
    DEVELOPER_NAME,
    COUNT(PROPERTY_ID) AS TOTAL_PROJECTS,
    SUM(TICKET_PRICE_CR) AS TOTAL_SALES,
    ROUND(AVG(TICKET_PRICE_CR), 2) AS AVG_TICKET_PRICE
FROM REAL_ESTATE_CLEAN
GROUP BY DEVELOPER_NAME
ORDER BY TOTAL_SALES DESC;

SELECT
    MICRO_MARKET,
    COUNT(*) AS TOTAL_RECORDS,
    SUM(BOOKING_FLAG) AS TOTAL_BOOKINGS,
    ROUND(
        (SUM(BOOKING_FLAG) * 100.0) / COUNT(*),
        2
    ) AS BOOKING_CONVERSION_RATE
FROM REAL_ESTATE_CLEAN
GROUP BY MICRO_MARKET
ORDER BY BOOKING_CONVERSION_RATE DESC;

SELECT
    ROUND(AMENITY_SCORE, 0) AS AMENITY_BUCKET,
    COUNT(*) AS TOTAL_PROPERTIES,
    SUM(BOOKING_FLAG) AS TOTAL_BOOKINGS,
    ROUND(
        (SUM(BOOKING_FLAG) * 100.0) / COUNT(*),
        2
    ) AS BOOKING_RATE
FROM REAL_ESTATE_CLEAN
WHERE AMENITY_SCORE IS NOT NULL
GROUP BY AMENITY_BUCKET
ORDER BY AMENITY_BUCKET;


SELECT
    CONFIGURATION,
    MICRO_MARKET,
    COUNT(*) AS TOTAL_PROPERTIES,
    SUM(BOOKING_FLAG) AS TOTAL_BOOKINGS
FROM REAL_ESTATE_CLEAN
GROUP BY 1,2
ORDER BY 2, 3 DESC;

SELECT
    SALES_CHANNEL,
    COUNT(*) AS TOTAL_LEADS,
    SUM(BOOKING_FLAG) AS TOTAL_BOOKINGS,
    ROUND(
        (SUM(BOOKING_FLAG) * 100.0) / COUNT(*),
        2
    ) AS CONVERSION_RATE
FROM REAL_ESTATE_CLEAN
GROUP BY SALES_CHANNEL
ORDER BY CONVERSION_RATE DESC;

SELECT
    POSSESSION_STATUS,
    BUYER_TYPE,
    COUNT(*) AS TOTAL_PROPERTIES,
    SUM(BOOKING_FLAG) AS TOTAL_BOOKINGS
FROM REAL_ESTATE_CLEAN
GROUP BY POSSESSION_STATUS, BUYER_TYPE
ORDER BY POSSESSION_STATUS;








    




